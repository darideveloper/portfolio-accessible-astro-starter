---
import { Heading, Link } from 'accessible-astro-components'
import { Icon } from 'astro-icon/components'

/**
 * FeaturedPosts Component
 *
 * @description A component that displays featured blog posts from JSONPlaceholder API
 */
interface Props {
  /**
   * Additional classes to apply to the section
   */
  class?: string
  /**
   * The number of posts to display
   * @default 3
   */
  limit?: number
  /**
   * The title for the section
   * @default "Latest posts"
   */
  title?: string
}

interface Post {
  id: number
  userId: number
  title: string
  body: string
  featuredImage: string
  shortUrl: string
}

const { class: className, limit = 3, title = 'Ãšltimos posts' } = Astro.props

// Fetch posts from API
const response = await fetch('https://jsonplaceholder.typicode.com/posts')
const data = await response.json()

// Use string paths from /public/posts/
const postImages = [
  '/posts/post-image-1.png',
  '/posts/post-image-2.png',
  '/posts/post-image-3.png',
]

// Function to truncate title for better display
function truncateTitle(title: string): string {
  const words = title.split(' ')
  const truncated = words.slice(0, 4).join(' ')
  return truncated
}

// Process and limit posts for featured section
const featuredPosts: Post[] = data.slice(0, limit).map((post: any) => {
  const truncatedTitle = truncateTitle(post.title)
  return {
    ...post,
    featuredImage: postImages[post.id % postImages.length],
    title: truncatedTitle,
    shortUrl: truncatedTitle.replaceAll(' ', '-').toLowerCase(),
  }
})
---

<section class:list={[className, 'my-64']}>
  <div class='container'>
    <Heading
      level='h2'
      class='mb-6'
      >{title}</Heading
    >
    <div class='grid grid-cols-1 gap-12 md:grid-cols-2 lg:grid-cols-3'>
      {
        featuredPosts.map((post) => (
          <article class='flex h-full flex-col overflow-hidden rounded-lg border border-neutral-200 bg-white shadow-sm transition-shadow hover:shadow-md dark:border-neutral-800 dark:bg-neutral-900'>
            <a
              href={'/blog/' + post.shortUrl}
              class='block'
            >
              <div class='relative h-48 w-full overflow-hidden'>
                <img
                  src={post.featuredImage}
                  alt={post.title}
                  class='h-full w-full object-cover'
                  loading='lazy'
                />
              </div>
            </a>
            <div class='flex flex-1 flex-col p-6'>
              <h2 class='mb-2 text-xl font-semibold'>
                <a
                  href={'/blog/' + post.shortUrl}
                  class='hover:underline'
                >
                  {post.title}
                </a>
              </h2>
              <p class='mb-4 flex-1 text-neutral-600 dark:text-neutral-400'>
                {post.body}
              </p>
              <footer class='mt-auto text-sm text-neutral-500 dark:text-neutral-400'>
                User ID: {post.userId}
              </footer>
            </div>
          </article>
        ))
      }
    </div>
    <div class='mt-12'>
      <Link
        href='/blog/'
        isButton
        animateOnHover
        animationType='nudge'
      >
        Ver todos los posts
        <Icon
          aria-hidden='true'
          name='lucide:arrow-right'
          size='1.5rem'
        />
      </Link>
    </div>
  </div>
</section>
