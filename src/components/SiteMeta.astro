---
import { SITE } from '../lib/constants/site'

/**
 * SiteMeta Component
 *
 * @description Component to handle site metadata and essential head elements
 */
interface Props {
  /**
   * The title of the page
   */
  title: string
  /**
   * The description of the page
   */
  description: string
  /**
   * The URL of the page (optional, defaults to current URL)
   */
  url?: string
  /**
   * The image path for social sharing
   */
  image: string
  /**
   * The author of the page
   */
  author?: string
  /**
   * Type of page ('website' or 'article')
   */
  type?: 'website' | 'article'
  /**
   * Publication date for articles
   */
  publishDate?: string
  /**
   * Keywords for the page
   */
  keywords?: string
  /**
   * Robots meta tag content
   */
  robots?: string
  /**
   * Language of the page (optional, defaults to English)
   */
  lang?: string
  /**
   * Open Graph locale
   */
  ogLocale?: string
  /**
   * Breadcrumbs for the page
   */
  breadcrumbs?: Array<{ name: string; item: string }>
}

const {
  title,
  description,
  url = Astro.url.href,
  image,
  author = SITE.author,
  type = 'website',
  publishDate,
  keywords,
  robots = 'index, follow',
  lang = SITE.defaultLanguage,
  ogLocale = 'en_US',
  breadcrumbs = [],
} = Astro.props

const fullTitle = `${title} - ${SITE.title}`
const imageUrl = `${Astro.site}${image}`

// JSON-LD Logic
const schemas = []

// Organization Schema
schemas.push({
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: SITE.name,
  url: SITE.url,
  logo: `${SITE.url}/logo.png`,
  sameAs: ['https://twitter.com/darideveloper'],
})

// Breadcrumb Schema
if (breadcrumbs.length > 0) {
  schemas.push({
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: breadcrumbs.map((crumb, index) => ({
      '@type': 'ListItem',
      position: index + 1,
      name: crumb.name,
      item: crumb.item,
    })),
  })
}

// Article Schema
if (type === 'article') {
  schemas.push({
    '@context': 'https://schema.org',
    '@type': 'BlogPosting',
    headline: title,
    description: description,
    image: imageUrl,
    datePublished: publishDate,
    author: {
      '@type': 'Person',
      name: author,
    },
  })
}
---

<!-- general meta -->
<meta
  name='title'
  content={fullTitle}
/>
<meta
  name='description'
  content={description}
/>
<meta
  name='author'
  content={author}
/>
{
  keywords && (
    <meta
      name='keywords'
      content={keywords}
    />
  )
}
<meta
  name='robots'
  content={robots}
/>

<!-- canonical url -->
<link
  rel='canonical'
  href={url}
/>

<!-- hreflang -->
<link
  rel='alternate'
  href={url}
  hreflang='x-default'
/>
<link
  rel='alternate'
  href={url}
  hreflang={lang}
/>

<!-- open graph -->
<meta
  property='og:title'
  content={fullTitle}
/>
<meta
  property='og:description'
  content={description}
/>
<meta
  property='og:type'
  content={type}
/>
<meta
  property='og:url'
  content={url}
/>
<meta
  property='og:image'
  content={imageUrl}
/>
<meta
  property='og:site_name'
  content={SITE.name}
/>
<meta
  property='og:locale'
  content={ogLocale}
/>

<!-- twitter card -->
<meta
  name='twitter:card'
  content='summary_large_image'
/>
<meta
  name='twitter:site'
  content={SITE.twitter}
/>
<meta
  name='twitter:creator'
  content={SITE.twitter}
/>
<meta
  name='twitter:title'
  content={fullTitle}
/>
<meta
  name='twitter:description'
  content={description}
/>
<meta
  name='twitter:image'
  content={imageUrl}
/>

<!-- json-ld -->
{
  schemas.map((schema) => (
    <script
      type='application/ld+json'
      set:html={JSON.stringify(schema)}
    />
  ))
}

<!-- page title -->
<title>{fullTitle}</title>
