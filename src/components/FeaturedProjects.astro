---
import { Heading, Link } from 'accessible-astro-components'
import { Icon } from 'astro-icon/components'
import { getCollection } from 'astro:content'
import { getProjectFeaturedImage } from '@/utils/getProjectImage'

/**
 * FeaturedProjects Component
 *
 * @description A component that displays featured projects from Astro Content Collections
 */
interface Props {
  /**
   * Additional classes to apply to the section
   */
  class?: string
  /**
   * The number of projects to display
   * @default 3
   */
  limit?: number
  /**
   * The title for the section
   * @default "Featured projects"
   */
  title?: string
}

const { class: className, limit = 3, title = 'Proyectos destacados' } = Astro.props

// Get projects from content collection
const projects = await getCollection('projects')

// Limit projects and add featured images
const featuredProjects = projects.slice(0, limit).map((project) => ({
  ...project,
  featuredImage: getProjectFeaturedImage(project.id, project.data),
}))
---

<section class:list={[className, 'my-64']}>
  <div class='container'>
    <Heading
      level='h2'
      class='mb-6'
      >{title}</Heading
    >
    <div class='grid grid-cols-1 gap-12 md:grid-cols-2 lg:grid-cols-3'>
      {
        featuredProjects.map((project) => (
          <article class='group flex h-full flex-col overflow-hidden rounded-lg border border-neutral-200 bg-white shadow-sm transition-all duration-300 hover:shadow-md dark:border-neutral-800 dark:bg-neutral-900'>
            <a
              href={'/portfolio/' + project.id}
              class='block'
            >
              <div class='relative h-48 w-full overflow-hidden'>
                <img
                  src={project.featuredImage}
                  alt={project.data.title}
                  class='h-full w-full object-cover transition-transform duration-300 group-hover:scale-110'
                  loading='lazy'
                />
              </div>
            </a>
            <div class='flex flex-1 flex-col p-6'>
              <h2 class='mb-2 text-xl font-semibold'>
                <a
                  href={'/portfolio/' + project.id}
                  class='transition-colors duration-200 hover:text-brand-primary hover:underline'
                >
                  {project.data.title}
                </a>
              </h2>
              <p class='mb-4 flex-1 text-neutral-600 dark:text-neutral-400'>
                {project.data.description}
              </p>
              <footer class='mt-auto text-sm text-neutral-500 dark:text-neutral-400'>
                Author: {project.data.author}
              </footer>
            </div>
          </article>
        ))
      }
    </div>
    <div class='mt-12'>
      <Link
        href='/portfolio/'
        isButton
        animateOnHover
        animationType='nudge'
      >
        Ver todos los proyectos
        <Icon
          aria-hidden='true'
          name='lucide:arrow-right'
          size='1.5rem'
        />
      </Link>
    </div>
  </div>
</section>
